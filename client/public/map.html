<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>Mapa</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css' rel='stylesheet' />

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/f3ad1c6737.js"></script>

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery.js"></script>

    <style>

@import url('https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700,800,800i,900|Quicksand:300,400,500,700&subset=cyrillic,cyrillic-ext,latin-ext,vietnamese');

        /* Display a map */
        html{
            overflow-x:hidden !important;
			height:100%;
        }
       
	    body {
    margin: 0;
    padding: 0;       
	font-weight: 400;
	font-size: 13px;
	height:100%;
	background:rgb(198, 233, 255);
	color: white;
	font-family: 'Quicksand', sans-serif;
            

        }

        #map {
          
            position: absolute;
            top: 80px;
            bottom: 0;
            width: 100%;
            min-height: 110px;
           
            clear: both;
        }

        

        /* Display custom marker */
        .marker {
            display: block;
            border: none;
            cursor: pointer;
            padding: 0;
            background: no-repeat;
        }

        /* Popup when click */
        .mapboxgl-popup {
            max-width: 400px;
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        }

        /* Get coordinates of the mouse pointer */
        #info {
            display: block;
            margin: 0px auto;
            padding: 40px;
            border: 1px;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
            color: #222;
            background: #fff;
            margin-right: 0px;
            background-color: black!important;

        }

        /* Place the geocoder input outside the map */
        .geocoder {
            position: relative;
            z-index: 1;
            width: 50%;
            left: 0;
            top: 20px;
        }

        .mapboxgl-ctrl-geocoder {
            min-width: 100%;
        }

        svg.mapboxgl-ctrl-geocoder--icon {
            display: none;
        }

        #clearAll {
            color: #fff;
            background-color: #555;
            padding: 8px;
            margin: 10px;
            position: absolute;
            right: 0;
            top: 275px;
            border-radius: 0.5em;
            border-bottom: 2px #222 solid;
            cursor: pointer;
            z-index: 10;
        }

        .featurediv {
            position: absolute;
            margin-top: 10px; 
            height: 102px;

            clear: both;
            overflow: hidden;
            border-radius: 4px;
            color: white;
            background-color: transparent;


            
        }

        fieldset.scheduler-border {
          /*  border: 1px groove #ddd !important;  */
            padding: 0 1.4em 1.4em 1.4em !important;
            margin: 0 0 1.5em 0 !important;
            -webkit-box-shadow: 0px 0px 0px 0px #000;
			box-shadow: 0px 0px 0px 0px #000;
			
        }

        legend.scheduler-border {
            font-size: 1.6em !important;
            font-weight: bold !important;
            text-align: left !important;
            width: auto;
			padding: 0 10px;
			color: black;
			background-color: white;
           
        }

        footer {
            text-align: center;
            color: white;
            position: fixed;
            background-color: white;
            vertical-align: center;
            bottom: 0px;
            width: 100%;
            height: 80px;
            padding: 28px;
        }

        .copyright {
            text-align: center;
            vertical-align: center;
            padding: 22px;
            font-size: 16px;
            font-style: normal;
            font-weight: 800;
            text-transform: none;
            line-height: 25px;
            font-family: sans-serif;
            color: white;
        }

        img {
            height: 16px;
            width: 16px;
            background-color: white;
            float: center;
            margin-bottom: 2px;
        }
        .btn{
	background-color: white
} 
.bg-light{
    background-color: white!important;
}
    

/*-------------General Style---------------------------------------*/


@-o-viewport {width: device-width;}
@-ms-viewport {width: device-width;}
@viewport {width: device-width;}
/*--------------Typography--------------------------------------*/
p {
    font-size: 13px;
    line-height: 0px;
	padding: 3px 3px;
	margin: 0px; 
	font-weight:500;
    color: rgb(0, 0, 0);
    font-weight:bolder;
	background-color: white;
	z-index: 10;

}
#menu {
	font-size: 14px;
    line-height: 10px;
    padding: 3px 5px;
	font-weight:500;
    color: rgb(0, 0, 0);
    font-weight:bolder;
    background-color: white;
	border-radius: 1px;
	position: fixed;
	
}
blockquote {
	float:left;
	padding: 10px 20px;
	margin: 0 0 20px;
	font-size: 17.5px;
	border-left: 15px solid #eee;
	position:relative;
}
blockquote:before {
    font-family: FontAwesome;
    font-style: normal;
    font-weight: normal;
    text-decoration: inherit;
	content: "\f10e";
	position:absolute;
	color:#ccc;
	bottom:3px;
	font-size:43px;
	right:6px;
	opacity:0.4
}
blockquote p {
	font-family: Georgia, "Times New Roman", Times, serif;
	font-style:italic;
	color:#494949;
}

/* ---------Content Styles--------------------------------------*/
#main{
	height:100%;
	width:100%;
	position:absolute;
	top:0;
	left:0;
	z-index:2;
	opacity:0;
}
.container{
	max-width: 1224px;
	width:92%;
	margin:0 auto;
	position: relative;
	z-index:5;
}
.big-container {
	max-width:1500px;
}
.small-container {
	max-width:1024px;
}
#wrapper {
	float:left;
	width:100%;
	position:relative;
	z-index:5;
	padding-top:80px;
}
#wrapper.no-padding {
	padding-top:0;
}
.content, .col-md-12, .col-sm-12 {
	width:100%;
	position:relative;
	z-index:1000;
	float:left;
	background: black !important;
	padding: 50px
}
.content.fs-slider-wrap{
	padding-top:80px;
}
.fl-wrap {
	float:left;
	width:100%;
	position:relative;
}
.no-bg {
	background:none;
}
.full-height {
	height:100%;
}
.full-width-wrap {
	width:100%;
}
.bg {
	position:absolute;
	top:0;
	left:0;
	width:100%;
	height:100%;
	z-index:1;
	background-size: cover;
	background-attachment: scroll  ;
	background-position: center  ;
	background-repeat:repeat;
	background-origin: content-box;
}
.shapes-bg-small:before  , .shapes-bg-big:before  {
	content:'';
	position:absolute;
	top:0;
	left:0;
	width:100%;
	height:100%;
	background-repeat:repeat;
	opacity:0.3;
}

.respimg {
	width:100%;
	height:auto;
}
.overlay {
	position:absolute;
	top:0;
	left:0;
	width:100%;
	height:100%;
	background:#000;
	opacity:0.5;
	z-index:2
}
.box-item {
	float:left;
	width:100%;
	position:relative;
	overflow:hidden;
}

.box-item a.gal-link{
	position:absolute;
	width:40px;
	height:40px;
	line-height:40px;
	border-radius:100%;
	color:#fff;
	z-index:10;
	-webkit-transition: all 300ms linear;
    transition: all 300ms linear;
}
.fw-separator {
	float:left;
	width:100%;
	margin:25px 0;
	height:1px;
	background:#eee;
}
/* ------Header------------------------------------------------------------ */
.main-header {
	position:fixed;
	top:0;
	left:0;
	width:100%;
	z-index:100;
	
	padding:0 0 6px 0;
	height:50px;
}
.center-header .header-inner{
	max-width:1224px;
	margin:0 auto;
	position:relative;
}
.center-header .header-inner .show-search-button {
	display:block;
}
.center-header .header-search {
	display:none;
	position:absolute;
	left:20px;
	top:100px;
	border-radius:30px;
	box-shadow: 0px 0px 0px 7px rgba(0,0,0,0.2);
}
.dark-header {
	background:black;
}
.fs-header {
	padding:0px 50px;
}
.logo-holder {
	float:left;
	position:relative;
	top:25px;
	height:30px;
}
.logo-holder img {
	height:100%;
	width:auto;
}
.add-list {
	float:right;
	padding: 9px 32px;
	position:relative;
	top:20px;
	border-radius:30px;
	color:black ;
	font-weight:450;

	font-size:15px;
}
.add-list span {
	padding-left:4px;
	font-weight:700;
}
.dark-header .add-list {
	box-shadow:0px 0px 0px 6px black;
}
.dark-header .add-list:hover {
	box-shadow:0px 0px 0px 6px black;
}
.show-reg-form {
	float:right;
	color:#666;
	cursor:pointer;
	margin-right:40px;
	position:relative;
	top:34px;
	font-size:13px;
	font-weight:600;
}
.dark-header .show-reg-form {
	color:#fff;
}
.show-reg-form:before {
	content:'';
	position:absolute;
	top:50%;
	right:-20px;
	height:30px;
	width:1px;
	margin-top:-15px;
	background:rgba(255,255,255,0.41);
}
.dark-header .show-reg-form:before {
	color:#fff;
	background:rgba(255,255,255,0.21);
}
.show-reg-form i {
	padding-right:10px;
}
.vis-header-search {
	float:left;
	margin-left:30px;
	position:relative;
	top:20px;
}
.header-search-input-item input {
	border:none;
	height:40px;
	line-height:40px;
	padding:0 20px;
	float:left;
	width:130px;
}
.header-search-input-item {
	border-top-left-radius:20px;
	border-bottom-left-radius:20px;
	overflow:hidden;
	background:#fff;
}
.header-search-select-item {
	background:#fff;
	height:40px;
	border-left:1px solid #eee;
}
.header-search-select-item .nice-select {
	color:#292929;
	float:left;
	width:100%;
	border:none;
	min-width:150px;
    height: 40px;
    line-height: 40px;
}
.header-search-select-item .nice-select .list {
	width:100%;
	padding: 60px 12px 10px;
    background: #fff;
    border-radius: 4px;
}
.header-search-select-item .nice-select .list li{
	float:left;
	width:100%;
	padding: 5px 10px 6px;
    color: #666;
    font-size: 13px;
    border-radius: 2px;
	min-height:20px;
	line-height:20px;
}
.header-search-select-item .nice-select .nice-select-search {
	border:1px solid #eee;
}
.header-search-select-item .nice-select .list li:hover , .header-search-select-item .nice-select .list li.selected  {
	color:#fff;
}
.header-search-input-item  , .header-search-select-item , .header-search-button{
	float:left;
}
.header-search-button {
	height:40px;
	border:none;
	color:#fff;
	line-height:40px;
	border-radius:none;
	border-top-right-radius:20px;
	border-bottom-right-radius:20px;
	padding:0 30px;
	cursor:pointer;
}
.show-search-button {
	display:none;
	color:#fff;
	float:left;
	position:relative;
	margin-left:20px;
	top:32px;
	cursor:pointer;
	font-weight:600;
	padding-left:18px;
}

.sidenav {
  height: 100%;
  width: 0;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: white;
  overflow-x: hidden;
  transition: 0.5s;
  padding-top: 60px;
  text-align:left;
}

.sidenav a {
    font-family: "Lato", sans-serif;
  padding: 8px 8px 8px 32px;
  text-decoration: none;
  font-size: 25px;
  color: black;
  display: block;
  transition: 0.3s;

}

.sidenav a:hover{
  color: #f1f1f1;
}

.sidenav .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}

.hamburger {


}

.row {
	margin: 15px 5px; 
}



    </style>

</head>

<body>
		<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.min.js'></script>
		<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.css' type='text/css' />   
	

    <script
        src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.0/mapbox-gl-directions.js'></script>
    <link rel='stylesheet'
        href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.0/mapbox-gl-directions.css'
        type='text/css' />

       
        
    <!-- Navbar bootstrap -->
    <header class="main-header dark-header fs-header sticky">
        <div class="header-inner">
            <!-- <div class="logo-holder">
                <a href="index.html"><img src="images/logo.png" alt=""></a>
            </div> -->
            
            </div>
          
   <div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times; </a>
  <hr>
  <a href="/home">Home</a>
  <a href="/recent">Recent-Searches</a>
  <a href="map.html">Map</a>
  <a href="/inputdata">User Posts</a>
  <a href="/signup">Log In/Sign Up</a>
  <hr>
  <a href="#"><i>MAPA</i></a>  
     </div>
  
	 <div class='row'>
 <span class='hamburger' style="font-size:30px;color: white; cursor:pointer" onclick="openNav()">&#9776; </span>
		</div>



    </header>
    <!-- Map -->
    <div id='map'></div>

    <!-- Clear all button -->
    <div id='clearAll' class='button'>Clear all</div>

    <!-- Get coordinates of the mouse pointer -->
    <pre id='info'></pre>

    <!-- Radio button for select feature -->
    <div class="featurediv">
        <form action="#" method="post" class="featureForm" id="featureForm">
            <fieldset class="scheduler-border">
  
	
		<!--		<legend class="scheduler-border"><strong>Choose And Display Markers</strong></legend>    -->
			
 <div id='menu'>
	 <!--	
		<input id='streets-v11' type='radio' name='rtoggle' value='streets' checked='checked'>
		<label for='streets'>Street</label>
		<input id='satellite-v9' type='radio' name='rtoggle' value='satellite'>
		<label for='satellite'>Satellite</label>
 -->
		<!--
		<input id='light-v10' type='radio' name='rtoggle' value='light'>
<label for='light'>Light View</label>
<input id='dark-v10' type='radio' name='rtoggle' value='dark'>
<label for='dark'>Dark View</label>
		-->
 </div>
			
            <p style=" padding: 9px;" >  Choose A Marker</p>
                <p>
				
                    <label><input type="radio" id="feature" name="feature" value="water" /> Water Fountain</label>
				</p>
				<p>	<label><input type="radio" id="feature" name="feature" value="bathroom" /> Bathroom</label> </p>

                  <p>  <label><input type="radio" id="feature" name="feature" value="bicycle" /> Bicycle Rack</label>

                </p>
	

            </fieldset>
		</form>
	

    </div>
   
<!--
	<footer>
        <text class="copyright">Add a location by clicking on a marker type and double clicking the map! </text>
     
        </a>
    </footer>
-->


    <script>

		function openNav() {
  document.getElementById("mySidenav").style.width = "100%";
}

function closeNav() {
  document.getElementById("mySidenav").style.width = "0%";
}

       
$(document).ready(function(){




var x; 
var y; 
var z; 
$.get('/api/searchs/', function(data,status) {


		// get the last saved item from the database
		// PROBLEM if an item has already been search this won't work!! 
		// this only works for newly searched items!
	var dostuff = data.filter(item=>  { return item.saved===true}  );
		console.log('the saved locations: ')

		console.log(dostuff)
		
		x = dostuff[dostuff.length-1].longitude;
	    y = dostuff[dostuff.length-1].latitude;
		 z = 12; 
		 
		 var changezoom = dostuff[dostuff.length-1].address.split(",").length; 
		 //cut this into words and if word length is 2 it is a state
		// alert(changezoom===2);
		// alert(dostuff[dostuff.length-1].address.split(",").length); 
		// alert(dostuff[dostuff.length-1].address.split(","))
			if (changezoom===2) {
				z = 5; 
			}


}
)

setTimeout(function(){ 
	mapboxgl.accessToken = 'pk.eyJ1IjoiZGF2aWR2bzE5OTAiLCJhIjoiY2p4MmsyOXJsMDAxYTQ4cGg3cHMwcTZkMCJ9.mHHhKy1QIfmGF_TC88vSUg';

var map = new mapboxgl.Map({
	container: 'map',
	style: 'mapbox://styles/mapbox/streets-v11',
	center: [x, y],
	zoom: z,
    // zoom of 5 is good for states
});
map.doubleClickZoom.disable()

 
	
 
 map.addControl(new MapboxGeocoder({
    accessToken: mapboxgl.accessToken,
    mapboxgl: mapboxgl
}));
//this adds fullscreen mode(below)
//map.addControl(new mapboxgl.FullscreenControl());	
map.addControl(new mapboxgl.NavigationControl());
/**
var userLocation = new mapboxgl.GeolocateControl({
	positionOptions: {
		enableHighAccuracy: true
	},
	trackUserLocation: true
})
map.addControl(userLocation);
userLocation.on('geolocate', function (e) {
	var lon = e.coords.longitude;
	var lat = e.coords.latitude
	var position = [lon, lat];
	// console.log(position);
	mapDirections.setOrigin(position)

});

var mapDirections = new MapboxDirections({
	accessToken: mapboxgl.accessToken
})
	**/


//map.addControl(mapDirections, 'top-left');   //this is search bar on the top left of the screen 




   //}, 100); closed  below

/**
mapboxgl.accessToken = 'pk.eyJ1IjoiZGF2aWR2bzE5OTAiLCJhIjoiY2p4MmsyOXJsMDAxYTQ4cGg3cHMwcTZkMCJ9.mHHhKy1QIfmGF_TC88vSUg';

var map = new mapboxgl.Map({
	container: 'map',
	style: 'mapbox://styles/mapbox/streets-v11',
	center: [-93.258133, 44.986656],
	zoom: 13,
   
});


**/


var clearAll = document.getElementById('clearAll');
clearAll.onclick = function () {
	location.reload();

	// map = new mapboxgl.Map({
	//     container: 'map',
	//     style: 'mapbox://styles/mapbox/streets-v11',
	//     center: [-93.258133, 44.986656],
	//     zoom: 13
	// });

}

/*
 var geojson = {
 "type": "FeatureCollection",
 "features": [
 {
 "type": "Feature",
 "properties": {
 "message": "Foo",
 "iconSize": [60, 60]
 },
 "geometry": {
 "type": "Point",
 "coordinates": [
 -93.258462890625,
 44.986695711685304
 ]
 }
 }
 ]
 };
 */


var waterCoor = [];
var bathroomCoor = [];
var bicycleCoor = [];
var waterMessage = [];
var bathroomMessage = [];
var bicycleMessage = [];
var waterName = [];
var bathroomName = [];
var bicycleName = [];
var waterAddress = [];
var bathroomAddress = [];
var bicycleAddress = [];



//whatever the url of the page is...search that via another get request?

$.getJSON("/api/locations", function (data) {
	console.log('this is the data that is onload')
	console.log(data)

	for (var i = 0; i < data.length; i++) {

		var coor = [data[i].longitude, data[i].latitude]    //coor is short for coordinates
		if (data[i].feature === "water") {
			waterCoor.push(coor);
			waterMessage.push(data[i].message)
			waterName.push(data[i].name)
			waterAddress.push(data[i].address)
	
		}
		else if (data[i].feature === "bathroom") {
			bathroomCoor.push(coor)
			bathroomMessage.push(data[i].message)
			bathroomName.push(data[i].name)
			bathroomAddress.push(data[i].address)
		}
		else if (data[i].feature === "bicycle") {
			bicycleCoor.push(coor)
			bicycleMessage.push(data[i].message)
			bicycleName.push(data[i].name)
			bicycleAddress.push(data[i].address)
		}
	}
	//on page load, load the previous markers from the database
	createGeojson(waterCoor, waterMessage, "water.png", waterName, waterAddress);
	makeMarkers(features, "water")
	createGeojson(bathroomCoor, bathroomMessage, "bathroom.png", bathroomName, bathroomAddress);
	makeMarkers(features, "bathroom")
	createGeojson(bicycleCoor, bicycleMessage, "bicycle.png", bicycleName, bicycleAddress);
	makeMarkers(features, "bicycle")
})


var features = [];

function createGeojson(arr, mess, image, name, address) {       //this function is called below 
	for (var i = 0; i < arr.length; i++) {

		features.push(
			{
				"type": "Feature",
				"properties": {
					"message": mess[i],
					"iconSize": [50, 50],
					"image": image,
					"name": name[i],
					"address": address[i]
				},
				"geometry": {
					"type": "Point",
					"coordinates": arr[i]
				}
			}

		)

	}
};


// get list of radio buttons with name 'feature'
var sz = document.forms['featureForm'].elements['feature'];      //the number of the form elements on the page is 3?

// loop through list
for (var i = 0, len = sz.length; i < len; i++) {
  //  console.log(sz[i]);
	sz[i].onclick = function () {         //when you click on one of the three buttons do this


		if (this.value === "water") {
			features = [];      //features is not empty check above code line 325
	
			createGeojson(waterCoor, waterMessage, "water.png", waterName, waterAddress);
		 //   alert(features)
			makeMarkers(features, this.value)
		} else if (this.value === "bathroom") {
			features = [];
			createGeojson(bathroomCoor, bathroomMessage, "bathroom.png", bathroomName, bathroomAddress);
			//console.log(features)
			makeMarkers(features, this.value)
		} else if (this.value === "bicycle") {
			features = [];
			createGeojson(bicycleCoor, bicycleMessage, "bicycle.png", bicycleName, bicycleAddress);
			//console.log(features)
			makeMarkers(features, this.value)
		}
	}
};

//console.log(features)

// var geojson = {
// "type": "FeatureCollection",
// "features": features

// };


//console.log(geojson)



// Get coordinates of the mouse pointer
/**
map.on('mousemove', function (e) {
	// console.log(e)
	document.getElementById('info').innerHTML =
		// e.point is the x, y coordinates of the mousemove event relative
		// to the top-left corner of the map
		// JSON.stringify(e.point) + '<br />' +
		// e.lngLat is the longitude, latitude geographical position of the event
		"Longitude: " + JSON.stringify(e.lngLat.lng) + ", Latitude: " + JSON.stringify(e.lngLat.lng);
});
**/
// View a fullscreen map
//map.addControl(new mapboxgl.FullscreenControl());

// Add zoom and rotation controls to the map.
//map.addControl(new mapboxgl.NavigationControl());

// Locate the user
// Add geolocate control to the map.

var userLocation = new mapboxgl.GeolocateControl({
	positionOptions: {
		enableHighAccuracy: true
	},
	trackUserLocation: true
})
map.addControl(userLocation);
userLocation.on('geolocate', function (e) {
	var lon = e.coords.longitude;
	var lat = e.coords.latitude
	var position = [lon, lat];
	// console.log(position);
	mapDirections.setOrigin(position)

});



//Directions navigation
/**
var mapDirections = new MapboxDirections({
	accessToken: mapboxgl.accessToken
})
map.addControl(mapDirections, 'top-left');

**/





// mapDirections.setOrigin([-93.256, 44.985])
// mapDirections.setDestination([-93.259, 44.989])




function makeMarkers(features, type) {
	   
 

	var geojson = {
		"type": "FeatureCollection",
		"features": features

	};

	// Add custom markers to map
	geojson.features.forEach(function (marker) {
		// create a DOM element for the marker
		var el = document.createElement('div');
		el.className = 'marker';
		// el.style.backgroundImage = 'url(https://placekitten.com/g/' + marker.properties.iconSize.join('/') + '/)';
		el.style.backgroundImage = 'url(./assets/img/' + marker.properties.image + ')';
		el.style.width = marker.properties.iconSize[0] + 'px';
		el.style.height = marker.properties.iconSize[1] + 'px';

		el.addEventListener('click', function () {
		  //  window.alert(marker.geometry.coordinates + marker.properties.message);
			mapDirections.setDestination(marker.geometry.coordinates);

		});
		// This is the message popup
		var popup = new mapboxgl.Popup({ offset: 25 })
			// .setText(marker.properties.message)
			.setHTML('<h5>' + marker.properties.address + '</h5><p>'
				+ '<strong>Message:</strong> ' + marker.properties.message + '</p><p>'
				+ ' Add by: <strong>' + marker.properties.name + '</strong>')


		// add marker to map
		new mapboxgl.Marker(el)
			.setLngLat(marker.geometry.coordinates)
			.setPopup(popup)
			.addTo(map);
	})



};

//--------------------------------------------------------------
//code below is for adding different modes to the map

var layerList = document.getElementById('menu');
var inputs = layerList.getElementsByTagName('input');         //gets the value of the menu that you click on 

function switchLayer(layer) {
var layerId = layer.target.id;      //layer will change depending on which style you opick

map.setStyle('mapbox://styles/mapbox/' + layerId);
}

for (var i = 0; i < inputs.length; i++) {
inputs[i].onclick = switchLayer;         // the map changs in accordance to what u click on
}


//-------------------------------------------------------------------------------------------------------------------------
// code below is for adding new markers to the map

var features1 = [];
//make an array that keeps all of the pointer clicks  

features1.push(
			{
				"type": "Feature",
				"properties": {
					"message": 'Hello',
					"iconSize": [50, 50],
			  //      "image": image,
					"name": 'Tony',
					"address": 'none'
				},
				"geometry": {
					"type": "Point",
					"coordinates": [
							-63.222,
							-18.28151823530889
		]
				}
			}
)

//console.log(features1[0].geometry.coordinates);  
//now we need to be able to change the coordinates

// features[0].geometry.coordinates[0] =  turnintostring; 
// features[0].geometry.coordinates[1] =   turninto; 

map.on("dblclick",   function (e) {

e.preventdefault; 
var cord =  JSON.stringify(e.lngLat);   //get the coordinates which our in a string....make a post here into the database????
// console.log(cord);
var result = cord.split(',').map(e => e.split(':'));
var turnintostring = result[0][1].toString();
  //  console.log(result);
  //converting the longitude and latitude into a seperate string
var remove = result[1].join().split('}').map(e=>e.split(','));
var turninto = remove[0][1].toString();
// 
// console.log('the longitdue is' +  result[0][1]);
//  console.log('the latitiude is ' + result[1][1]);   cannot use this
//  console.log('the latitude is ' +  remove[0][1]);
console.log('the longitude is ' + turnintostring);
console.log('the latititude is ' + turninto);          // now u have the longitude and latitude as a string !!!

features1[0].geometry.coordinates[0] =  turnintostring;          //change the the longitude to your mouse cursor !
features1[0].geometry.coordinates[1] =   turninto;                      //change the latitude to your mouse cursor !s
console.log( features1[0].geometry.coordinates );  //basically the coordites are changing each time!


//you have longitude and latitude but not the actual place. Now we Need to do reverse geocoding to get the address:
var address1 = ""; 


//somehow get the longitude and latitude from the search bar. it's in your database bro




function newcoords (longitude, latitude,type) {
var x = 'https://api.mapbox.com/geocoding/v5/mapbox.places/'+longitude+','+latitude+'.json?types=address&access_token=pk.eyJ1IjoiZGF2aWR2bzE5OTAiLCJhIjoiY2p4MmsyOXJsMDAxYTQ4cGg3cHMwcTZkMCJ9.mHHhKy1QIfmGF_TC88vSUg';
//console.log(x);
$.get( x, function(data,status) {
//  console.log(data.features[0].place_name);   // now we have the address!
address1 = data.features[0].place_name;

console.log(status);

});
//wait two seconds and the value of the address, then make a post 
setTimeout(() => {
var x = '/searchlocations/' + address1; 
//  console.log(x);  
$.post(x , {
		   longitude: longitude,
			latititude: latitude,
			name: "Anonymous Person",
			message: "",
			feature: type },
			
			
			function (data, status) {
				console.log('the post status is ' + status);
			//  console.log(data);
			});



}, 2000);


makeMarkers1(features1,this.value);

};
//setInterval(function(){ console.log(address1) }, 3000);

newcoords(turnintostring, turninto, selectedValue);
makeMarkers1(features1,this.value);    //load all the previous markers...




function makeMarkers1 (features,type) {


var geojson = {
		"type": "FeatureCollection",
		"features": features};

// add markers to map      features is an array above
geojson.features.forEach(function(marker) {           
// create a DOM element for the marker
var el = document.createElement('div');
el.className = 'marker';
//  el.style.backgroundImage = 'url(https://placekitten.com/g/' + marker.properties.iconSize.join('/') + '/)';
// el.style.backgroundImage = 'url(./assets/img/' + marker.properties.image + ')';
el.style.backgroundImage = 'url(./assets/img/marker.png)';
el.style.width = marker.properties.iconSize[0] + 'px';
el.style.height = marker.properties.iconSize[1] + 'px';

el.addEventListener('click', function() {
// window.alert(marker.properties.message);
console.log(el);  // the above variable which is a custome made div
});

// add marker to map
new mapboxgl.Marker(el)  //still in the for loop
.setLngLat(marker.geometry.coordinates)            //uses the above object for the coordinates....

.addTo(map);      //add to the map div
});

}

});

// when you click on one of the three values get its value 
var selectedValue = ''; 
$("input[type='radio']").on('click', function () {
  selectedValue = $("input[name=feature]:checked").val();
//     console.log(selectedValue);
});

$("input[type='radio']").hover( function () {
//  selectedValue = $("input[name=feature]:checked").val();
$(this).css('cursor','pointer').attr('title', 'DOUBLE CLICK ON THE MAP TO ADD A MARKER.')
});

$('p').hover( function () {
//  selectedValue = $("input[name=feature]:checked").val();
$(this).css('cursor','pointer').attr('title', 'DOUBLE CLICK ON THE MAP TO ADD A MARKER.')
});

}, 100);  // this ends the settimeout. maybe not the best solution. is there an alternative?


});


    </script>

</body>



</html>